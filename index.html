<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
		<title>Association Flosteosarcome - course caritative Mars 2023</title>
		<script type="text/javascript" src="js/jquery.js"></script>
		<script type="text/javascript" src="js/bootstrap.min.js"></script>
		<script type="text/javascript" src="js/timer.js"></script>
		<script type="text/javascript" src="js/script.js"></script>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
		<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
		<link href='https://fonts.googleapis.com/css?family=Lobster&display=swap' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Lato:400,600&display=swap' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="css/custom.css">
	</head>
	<body>
		<!-- Carousel -->
		<div id="myCarousel" class="carousel slide" data-ride="carousel">
		    <!-- Indicators -->
		    <ol class="carousel-indicators">
		        <li data-target="#myCarousel" data-slide-to="0" class="active">1</li>
		        <li data-target="#myCarousel" data-slide-to="1">2</li>
		        <li data-target="#myCarousel" data-slide-to="2">3</li>
		    </ol>
		    <div class="carousel-inner">
		    	<div class= "container timer">
		    		<header id="home" class="logo logo-home">
						<div id="logo">
							<img src="img/logo-only.png" alt="Logo association Flostéosarcome" />
							<span>flosteosarcome</span>
						</div>
						<nav>
							<ul>
								<li><a href="index.html">Accueil</a></li>
								<li><a href="association.html">L'association</a></li>
								<li><a href="project.html">Les détails du projet</a></li>
								<li><a href="contact.html">Contact</a></li>
								<li><a  class="cta" href="dons.html"><span>Faire un don</span></a></li>
							</ul>
						</nav>
		    		</header>
			    	<div class= "row timer-circle">
			    		<div class= "main-text text-center">
							<h2 class="top-text">Marche caritative en faveur de</h2>
							<div class="main-associations">
								<a href="https://www.ligue-cancer.net"><img class="medium" src="img/assos/ligue.png" /></a>
								<a href="https://www.esean.fr"><img class="small" src="img/assos/esean.png" /></a>
							</div>
							<div class="desc">
								<h3>Projet sportif caritatif dans une optique de récolter des dons, l'objectif est de réaliser le tour des 4 îles autour de la
								Rochelle (l'île d'Oléron, l'île d'Aix , l'île Madame et l'île de Ré), soit environ 300 kms, en 14 jours</h3>
							</div>
							<h2 class="sub-text">Statistiques depuis le départ</h2>
			    		</div>
			    		<div class="text-center">
							<div class="numbers" id="count2"></div>
                        </div>
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">
                            <div class= "mini-square text-center">
                                <strong id="amount"><div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div></strong>&euro; récoltés
                            </div>
                        </div>
						<div class= "col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center container-circles">
							<div class= "mini-circle text-center">
								<div class= "row" id= "mini-spacer1">
									<div class= "title"></div>
									<div class= "numbers" id= "totald">
										<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>
									</div>
								</div>
								<div class= "row" id= "mini-spacer2">
									<div class= "title"></div>
									<div class= "title" id= "kms">kms</div>
								</div>
							</div>
							<div class= "mini-circle text-center">
								<div class= "row" id= "mini-spacer1">
									<div class= "title"></div>
									<div class= "numbers" id= "totalt">
										<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>
									</div>
								</div>
								<div class= "row" id= "mini-spacer2">
									<div class= "title"></div>
									<div class= "title" id= "hours">heures</div>
								</div>
							</div>
							<div class= "mini-circle text-center">
								<div class= "row" id= "mini-spacer1">
									<div class= "title"></div>
									<div class= "numbers" id= "totalv">
										<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>
									</div>
								</div>
								<div class= "row" id= "mini-spacer2">
									<div class= "title"></div>
									<div class= "title" id= "kmh">~ km/h</div>
								</div>
							</div>
							<div class= "mini-circle text-center">
								<div class= "row" id= "mini-spacer1">
									<div class= "title"></div>
									<div class= "numbers" style="font-size: 20px;" id= "totals">
										<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>
									</div>
								</div>
								<div class= "row" id= "mini-spacer2">
									<div class= "title"></div>
									<div class= "title" id= "step">pas</div>
								</div>
							</div>
						</div><!-- end of clock -->
			    	</div><!-- end of timer-circle -->
		    	</div><!-- end of timer -->
			    	
		        <div id="bg1" class="item active" style="background-image: url('img/img1.jpg');"></div>
		        <div id="bg2" class="item" style="background-image: url('img/img2.jpg');"></div>
		        <div id="bg3" class="item" style="background-image: url('img/img3.jpg');"></div>
			</div>
			<div id="partners">
				<a target="_blank" href="https://www.decathlon.fr"><img class="medium" src="img/partners/white/decathlon2.png" /></a>
				<a target="_blank" href="https://larochelleatlantique.rotary-1690.org/fr/"><img class="medium" src="img/partners/white/rotary2.png" /></a>
				<a target="_blank" href="https://www.maisongillardeau.fr"><img class="medium" src="img/partners/white/gillardeau.png" /></a>
				<a target="_blank" href="https://www.lheuredumarche.fr"><img class="big" src="img/partners/white/heuremarche.png" /></a>
				<a target="_blank" href="https://www.bemyapp.com"><img class="big" src="img/partners/white/bma.png" /></a>
				<a target="_blank" href="https://symaps-atlantique.com"><img class="small" src="img/partners/white/symaps.png" /></a>
				<a target="_blank" href="https://www.graphic.fr"><img class="medium" src="img/partners/white/graphic.png" /></a>
				<a target="_blank" href="https://www.doctolib.fr/pedicure-podologue/la-roche-sur-yon/xavier-reverseau"><img class="medium" src="img/partners/white/podologue.png" /></a>
				<a target="_blank" href="https://www.staderochelais.com"><img class="medium" src="img/partners/white/stade.png" /></a>
			</div>
		</div><!-- end of carousel -->

		<div class= "body-content">
			<div class= "container association">
				<div class="row text-center">
					<div class= "col-lg-8 col-lg-offset-2 association-text">
						<h3 class= "text-center">L'association</h3>
						<hr class= "full">
	                	<p>Flostéosarcome est une <strong>association caritative</strong> familiale créée par Florent TEILLET qui a pour but de créer et <strong>organiser des projets sportifs caritatifs</strong> dans une optique de récolter des dons. Ces dons seront reversés à diverses associations telles que la ligue contre le cancer ou bien des hôpitaux pour enfants.</p>
						<p>Le nom de l'association est une combinaison entre le diminutif de mon prénom (Flo) et le nom du cancer que j'ai eu étant plus jeune (ostéosarcome: cancer des os).</p>
						<div class="section-end">
							<a class="button-more" href="association.html">En savoir plus sur l'association</a>
						</div>
					</div>
				</div>
			</div>

	        <!-- share part -->
	      	<div class="container project">
				<div class="row text-center">
					<div class= "col-lg-8 col-lg-offset-2 share-text">
						<h3 class= "text-center">Le projet "Marche caritative Mars 2023"</h3>
						<hr class= "full">
						<p>L'association souhaite réaliser <strong>une marche caritative</strong> en faveur de <strong>la Ligue contre le cancer de Charente-Maritime et de l'hôpital pour enfants ESEAN</strong> situé à Nantes.</p>
						<p>L'objectif de cette marche est de <strong>réaliser le tour des 4 îles autour de la Rochelle, qui sont l'île d'Oléron, l'île d'Aix, l'île Madame et l'île de Ré</strong>. Je partirai du pont de l'île d'Oléron et après le tour de l'île, je remonterai vers le nord pour poursuivre avec les trois autres îles.</p>
						<p><strong>Tout cela uniquement à pied et dans un délai maximum de 14 jours</strong>.<br />La distance à parcourir sera d'environ <strong>300 kilomètres</strong>, soit en moyenne entre 20 et 25 kms par jour.<br />Je réaliserai la majorité du projet seul, ou accompagné de mes parents ou des personnes qui souhaiteraient faire un peu de marche avec moi et qui seraient évidemment les bienvenues. </p>
						<p id="title-map">Depuis le départ il y a <script>document.write(Math.round((new Date().getTime() -  new Date('2023-03-12T11:00:00Z').getTime()) / (1000*60*60*24)));</script> jours, voici le chemin parcouru:</p>
						

						<div style="height: 600px;" id="map">Chargement de la carte...</div>

						<p>Je souhaite également <strong>dépolluer au maximum le bord des routes</strong> en ramassant le plus grand nombre de déchets possibles durant le projet.</p>
						<p><strong>Les dons seront reversés en proportion de 50/50 entre chacune des 2 associations</strong> choisies via une cagnotte sur le site internet de l'association.</p>
							<p>Si j'ai décidé de faire cette marche c'est avant tout pour moi et me démontrer que je suis capable de me surpasser. Mais aussi pour tous les gens de ma famille ou des amis que j'ai connus et qui nous ont malheureusement quittés à cause de cette maladie. Il faut garder espoir et essayer de tout faire pour vaincre cette maladie.</p>
						<div class="section-end">
							<a class="button-more" href="project.html">En savoir plus sur le projet</a>
						</div>
					</div>
				</div>
			</div>
			<div class= "container share-icons text-center">
				<div class= "text-center">
					<div class= "col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<h4 class="section-title text-center">Suivez l'association</h4>
						<ul class="socials-icons col-lg-12 col-md-12 col-sm-12 col-xs-12">
							<li>
								<a href="https://www.facebook.com/profile.php?id=100089781917388" data-toggle="tooltip" title="Nous suivre sur Facebook" class="facebook"><i class="fa fa-facebook"></i></a>
							</li>
							<li>
								<a href="https://www.instagram.com/association_flosteosarcome" data-toggle="tooltip" title="Nous suivre sur Instagram" class="instagram"><i class="fa fa-instagram"></i></a>
							</li>
							<li>
								<a href="https://wa.me/33682241039" data-toggle="tooltip" title="Se connecter sur WhatsApp" class="whatsapp"><i class="fa fa-whatsapp"></i></a>
							</li>
						</ul> 
					</div>
				</div>
			</div><!-- end of share part -->
		</div><!-- end of body content -->
		<!-- footer -->
		<footer class="wrapper footer">
			<div class="container">
				<div class="text-center">
					<div class="name col-lg-2 col-md-3 col-sm-4 col-xs-12 text-center">
						<div id="logo">
							<img src="img/logo-only.png" alt="Logo association Flostéosarcome" />
							<span>flosteosarcome</span>
						</div>
					</div>
					<div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 text-center">
						<div class="copyright">
							&copy; <script>document.write( new Date().getUTCFullYear() );</script> Association flosteosarcome - <a href="legals.html">Mentions légales</a>
						</div>
					</div>
					<div class= "col-lg-2 col-md-2 col-sm-2 col-xs-12" id="back-top">
						<p class= "pull-right"><a href="#home"><span></span>Menu</a></p>	
					</div>
				</div>
			</div>
        </footer><!--end of footer -->
        <script src='https://www.gstatic.com/firebasejs/4.8.1/firebase.js'></script>
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
		<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
		<link rel="stylesheet" href="css/leaflet.extra-markers.min.css">
		<script src="js/leaflet.extra-markers.min.js"></script>
		<script>
			// GLOBALS
			let map = null;
			const coords = [];
			const defaultCoord = [46.050007, -1.246484];
			const defaultZoom = 10;
			let dbRef = null;
			let lastCoords = {
				latitude: 0,
				longitude: 0
			};

			// INIT MAT
			function initMap() {
				map = L.map('map').setView(defaultCoord, defaultZoom);
				L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
					maxZoom: 19,
					attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
				}).addTo(map);
			}

			// GEOLOC UTILITY
			function distanceBetweenCoords(lat1, lon1, lat2, lon2) {
				const R = 6371e3; // metres
				const φ1 = lat1 * Math.PI/180; // φ, λ in radians
				const φ2 = lat2 * Math.PI/180;
				const Δφ = (lat2-lat1) * Math.PI/180;
				const Δλ = (lon2-lon1) * Math.PI/180;
				const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
						Math.cos(φ1) * Math.cos(φ2) *
						Math.sin(Δλ/2) * Math.sin(Δλ/2);
				const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
				const d = R * c; // in metres
				return d;
			}

			// CONFIG FBASE
			var config = {
				apiKey: "AIzaSyDXPIxRuudFKZymWOXdTVHSC8CFSacHhGU",
				authDomain: "flosteosarcome2023.firebaseapp.com",
				databaseURL: "https://flosteosarcome2023-default-rtdb.firebaseio.com",
				projectId: "flosteosarcome2023",
				messagingSenderId: "firebase-adminsdk-kzina"
			};

			// INIT FIREBASE
			function initFirebase() {
				firebase.initializeApp(config);
				dbRef = firebase.database().ref();
				const amountRef = dbRef.child('amount');
				amountRef.on('value', (snapshot) => {
					const amount = snapshot.val();
					$('#amount').text(amount);
				});
			}

			let totalTimeInMS = 0;
			let lastTimeChecked = 0;
			let distance = 0;
			let lastCoordsChecked = {
				lat: 0,
				lng: 0
			};
			let beforeLastCoordsChecked = {
				lat: 0,
				lng: 0
			};
			let previousDayPolylines = [];
			let polyline = null;
			let isInitialDisplay = true;
			let isFirstDrawForToday = true;
			const coordsToday = [];
			const coordForDisplayPreviousDays = {
				12: [],
				13: [],
				14: [],
				15: [],
				16: [],
				17: [],
				18: [],
				19: [],
				20: [],
				21: [],
				22: [],
				23: [],
				24: [],
				25: [],
				26: [],
			};
			const colors = {
				12: '#E3413F',
				13: '#3f43fd',
				14: 'green',
				15: '#3f43fd',
				16: '#E3413F',
				17: '#3f43fd',
				18: '#E3413F',
				19: '#3f43fd',
				20: 'green',
				21: '#E3413F',
				22: '#3f43fd',
				23: '#E3413F',
				24: 'green',
				25: '#3f43fd',
				26: '#E3413F',
			}


			// DISPLAY ON MAP
			function displayData() {
				initMap();
				const locRef = dbRef.child('locations');
				locRef.on("child_added", snap => {
					let loc = snap.val();
					coords.push({
						date: loc.date,
						lat: loc.lat,
						lng: loc.lng
					});
					if (lastTimeChecked != 0 && loc.date - lastTimeChecked <= 60 * 2 * 1000) {
						totalTimeInMS += loc.date - lastTimeChecked;
					}
					if (lastCoordsChecked.lat != 0) {
						distance += distanceBetweenCoords(lastCoordsChecked.lat, lastCoordsChecked.lng, loc.lat, loc.lng);
					}
					lastTimeChecked = loc.date;
					beforeLastCoordsChecked.lat = lastCoordsChecked.lat;
					beforeLastCoordsChecked.lng = lastCoordsChecked.lng;
					lastCoordsChecked = {
						lat: loc.lat,
						lng: loc.lng
					}
					$('#totalt').text(Math.round(totalTimeInMS / 1000 / 60 / 60));
					$('#totald').text(Math.round(distance / 1000));
					$('#totals').text(Math.round(distance * 1.426));
					$('#totalv').text((distance / (totalTimeInMS / 1000) * 3.6).toFixed(2));

					const dayForTheCoord = new Date(loc.date).getDate();

					if (isInitialDisplay) {
						if (loc.date == '1679058039614' || loc.date == '1679061798002') {
							const marker = L.ExtraMarkers.icon({
								icon: 'fa-ship',
								markerColor: 'blue',
								iconColor: 'white',
								shape: 'circle',
								prefix: 'fa',
								extraClasses: 'fa-2x',
								svg: true
							});
							L.marker([loc.lat, loc.lng], {icon: marker}).addTo(map);
						}
						if (loc.date == '1679404978741' || loc.date == '1679404913684') {
							const marker = L.ExtraMarkers.icon({
								icon: 'fa-bicycle',
								markerColor: 'red',
								iconColor: 'white',
								shape: 'circle',
								prefix: 'fa',
								extraClasses: 'fa-2x',
								svg: true
							});
							L.marker([loc.lat, loc.lng], {icon: marker}).addTo(map);
						}
						coordForDisplayPreviousDays[dayForTheCoord].push({
							lat: loc.lat,
							lng: loc.lng
						});
						previousDayPolylines[dayForTheCoord] = L.polyline(coordForDisplayPreviousDays[dayForTheCoord], { color: colors[dayForTheCoord], weight: 3 });
					}

					if (!isInitialDisplay && map) {
						if (isFirstDrawForToday) {
							coordsToday.push({
								lat: beforeLastCoordsChecked.lat,
								lng: beforeLastCoordsChecked.lng
							});
							isFirstDrawForToday = false;
						}
						coordsToday.push({
							lat: loc.lat,
							lng: loc.lng
						});
						if (polyline) {
							polyline.remove();
						}
						polyline = L.polyline(coordsToday, { color: colors[dayForTheCoord], weight: 3 });
						polyline.addTo(map);
					}
				});
				if (map) {
					setTimeout(function() {
						previousDayPolylines.forEach((polylineDay, index) => {
							const marker = L.ExtraMarkers.icon({
								icon: 'fa-number',
								number: `J${index - 11}`,
								markerColor: colors[index],
								shape: 'square',
								prefix: 'fa',
								extraClasses: 'fa-2x',
								svg: true
							});
							L.marker([polylineDay._latlngs[0].lat, polylineDay._latlngs[0].lng], {icon: marker}).addTo(map);
							polylineDay.addTo(map);
							map.fitBounds(polylineDay.getBounds());
						});
					}, 1000 * 1);
				}
			}

			// RUNS
			setTimeout(initFirebase, 1000 * 5); // Run after 5 sec
			setTimeout(displayData, 1000 * 10); // Run after 10 sec
			setTimeout(function() {
				isInitialDisplay = false;
			}, 1000 * 15);
		</script>
	</body>
</html>